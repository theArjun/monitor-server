<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Command Sender</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css"
    />
  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      // When document is ready.
      document.addEventListener("DOMContentLoaded", function (event) {
        var socket = io("http://127.0.0.1:5000");

        // When someone connect to the socket.
        socket.on("connect", function () {
          socket.send("User has connected !");
        });

        socket.on("output_from_client_to_web", function(message) {
            document.getElementById("output_from_client").innerHTML = message;
        });

        socket.on("update_connections_list", function (connection_list) {
          console.log("Client got connected !");
          console.log(connection_list);

          //
          let connected_clients_table = document.getElementById(
            "connected_clients"
          );
          let new_table_row = document.createElement("tr");

          let client_ID_node = document.createElement("td");
          let client_ID_text_node = document.createTextNode(
            connection_list["client_ID"]
          );
          client_ID_node.appendChild(client_ID_text_node);

          let password_node = document.createElement("td");
          let password_text_node = document.createTextNode(
            connection_list["password"]
          );
          password_node.appendChild(password_text_node);

          let client_Session_ID_node = document.createElement("td");
          let client_Session_ID_text_node = document.createTextNode(
            connection_list["client_Session_ID"]
          );
          client_Session_ID_node.appendChild(client_Session_ID_text_node);

          new_table_row.append(client_ID_node);
          new_table_row.append(password_node);
          new_table_row.append(client_Session_ID_node);

          connected_clients.appendChild(new_table_row);
        });

        // When send button is clicked.
        var send_command = io("http://127.0.0.1:5000/command");
        document
          .getElementById("sendCommand")
          .addEventListener("click", function () {
            let client_ID = document.getElementById("client_ID").value;
            let command = document.getElementById("command").value;

            send_command.emit("command_from_web", {
              client_ID: client_ID,
              command: command,
            });
          });
      });

      console.log(io.sockets.clients());
    </script>

    <nav class="navbar" role="navigation" aria-label="main navigation">
      <div id="navbarBasicExample" class="navbar-menu">
        <div class="navbar-start">
          <a class="navbar-item">
            Commanding Server
          </a>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <div class="buttons">
              <a class="button is-primary">
                <strong>Sign up</strong>
              </a>
              <a class="button is-light">
                Log in
              </a>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <section class="hero is-primary">
      <div class="hero-body">
        <div class="container">
          <h1 class="title">
            Commanding Server
          </h1>
          <h2 class="subtitle">
            I will command everyone !
          </h2>
        </div>
      </div>
    </section>

    <div class="container is-block">
      <section class="section">
        <div class="level">
          <div class="level-left">
            <div class="level-item">
              <div class="field">
                <div class="control">
                  <input
                    type="text"
                    id="client_ID"
                    class="input is-info"
                    placeholder="Client ID"
                    required
                  />
                </div>
              </div>
            </div>

            <div class="level-item">
              <div class="field">
                <div class="control">
                  <input
                    type="text"
                    id="command"
                    class="input is-info"
                    placeholder="Command"
                    required
                  />
                </div>
              </div>
            </div>

            <div class="level-item">
              <button id="sendCommand" class="button is-primary">
                Command
              </button>
            </div>
          </div>
        </div>

        <p class="is-size-5 has-text-centered">
            Output
        </p>
        <p id="output_from_client" class="is-family-monospace has-text-centered" style="font-family: monospace; padding: 20px;">

        </p>
      </section>

      

      <section class="section">
        <div class="table-container">
            <table class="table">
                <thead >
                  <tr>
                    <th scope="col">Client ID</th>
                    <th scope="col">Password</th>
                    <th scope="col">Client Session ID</th>
                  </tr>
                </thead>
                <tbody id="connected_clients"></tbody>
              </table>
          </div>
      </section>
    </div>
  </body>
</html>
